pipeline:
  depoly-faas:
    image: mhsallam/bxcli
    secrets: [ bluemix_user, bluemix_password, bluemix_account, bluemix_org ]
    commands:
      - echo  $${BLUEMIX_USER}
      - bx login -u $${BLUEMIX_USER} -p $${BLUEMIX_PASSWORD} -c $${BLUEMIX_ACCOUNT} -a api.eu-gb.bluemix.net -o $${BLUEMIX_ORG} -s dev
      - bx target -g Default
      - bx wsk action update reports ./services/reports/reports.js

  build-api:
    image: node:6.12
    commands:
      - npm run install:api
      - npm run build:api
      # - npm run test:api

  docker:
    image: plugins/docker
      dockerfile: api/Dockerfile
      repo: mhsallam/reporthubapi
      insecure: true

  # api-image:
  #   image: plugins/docker
  #     context: api
  #     repo: mhsallam/reporthubapi
  #     insecure: true



  # deploy-api:
  #   image: node:alpine
  #   commands:
  #     - npm run prestart:prod

  # build:
  #   image: node6-alpine
  #   commands:
  #   # ineasted of (npm run postinstall) which will be time consuming with drone server
  #   # we can build a docker image that copies all node_modules with CMD layer that will
  #   # only be rebuild if the package.json is different thatn the one in the docker image
  #     - npm run postinstall
  #     - npm run test
  #     - npm run build

  # start dockerizing and deploying
  # depoly:
  #   image: node6-alpine
  #   commands:

  gitter:
    image: plugins/gitter
    webhook: https://webhooks.gitter.im/e/d93462d24fbcff832c6d